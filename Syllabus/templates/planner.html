<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Syllabus Study Planner - AI Course Scheduler</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='planner.css') }}">
</head>
<body>
  <div class="container">
    <h1>üìÖ Syllabus Study Planner</h1>
    <p>Upload your syllabus and get a personalized week-by-week study schedule!</p>

    <div class="input-section">
      <div class="form-group">
        <label for="duration">Course Duration (weeks):</label>
        <input type="number" id="duration" min="1" max="52" value="10" />
      </div>

      <div class="form-group">
        <label for="syllabus-input">Paste Your Syllabus:</label>
        <textarea 
          id="syllabus-input" 
          placeholder="Paste your course syllabus here... Include topics, learning objectives, and any important details."
          rows="10"
        ></textarea>
        <div class="file-upload">
          <label for="file-input" class="file-label">
            üìé Or upload a text file
          </label>
          <input type="file" id="file-input" accept=".txt,.md" style="display: none;" />
        </div>
      </div>

      <button onclick="generateSchedule()" id="generate-btn">
        ‚ú® Generate Study Schedule
      </button>
    </div>

    <div id="result-section" class="result-section" style="display: none;">
      <div class="result-header">
        <h2>üìö Your Personalized Study Schedule</h2>
        <button onclick="copySchedule()" class="copy-btn">üìã Copy</button>
      </div>
      <div id="schedule-output" class="schedule-output"></div>
    </div>

    <div class="footer">
      <small>Powered by Groq AI üöÄ</small>
    </div>
  </div>

  <script>
    const syllabusInput = document.getElementById("syllabus-input");
    const fileInput = document.getElementById("file-input");
    const durationInput = document.getElementById("duration");
    const generateBtn = document.getElementById("generate-btn");
    const resultSection = document.getElementById("result-section");
    const scheduleOutput = document.getElementById("schedule-output");

    // Handle file upload
    fileInput.addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          syllabusInput.value = e.target.result;
        };
        reader.readAsText(file);
      }
    });

    async function generateSchedule() {
      const syllabus = syllabusInput.value.trim();
      const duration = parseInt(durationInput.value);

      if (!syllabus) {
        alert("Please paste your syllabus or upload a file!");
        return;
      }

      if (duration < 1 || duration > 52) {
        alert("Please enter a valid duration (1-52 weeks)");
        return;
      }

      // Disable button and show loading
      generateBtn.disabled = true;
      generateBtn.innerHTML = "‚è≥ Generating your schedule...";
      resultSection.style.display = "none";

      try {
        const res = await fetch("/generate-schedule", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ 
            syllabus: syllabus,
            duration: duration 
          })
        });

        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }

        const data = await res.json();

        if (data.error) {
          throw new Error(data.error);
        }

        // Display the schedule with formatting
        scheduleOutput.innerHTML = formatSchedule(data.schedule);
        resultSection.style.display = "block";
        
        // Smooth scroll to results
        resultSection.scrollIntoView({ behavior: "smooth", block: "start" });

      } catch (error) {
        alert("‚ùå " + error.message);
        console.error("Error:", error);
      } finally {
        generateBtn.disabled = false;
        generateBtn.innerHTML = "‚ú® Generate Study Schedule";
      }
    }

    function formatSchedule(text) {
      // Convert markdown-style formatting to HTML
      let formatted = text
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')  // Bold
        .replace(/\n/g, '<br>')  // Line breaks
        .replace(/^(WEEK \d+.*?)$/gm, '<div class="week-header">$1</div>')  // Week headers
        .replace(/^(- Monday:.*?)$/gm, '<div class="day-item">$1</div>')  // Days
        .replace(/^(- Tuesday:.*?)$/gm, '<div class="day-item">$1</div>')
        .replace(/^(- Wednesday:.*?)$/gm, '<div class="day-item">$1</div>')
        .replace(/^(- Thursday:.*?)$/gm, '<div class="day-item">$1</div>')
        .replace(/^(- Friday:.*?)$/gm, '<div class="day-item">$1</div>');
      
      return formatted;
    }

    function copySchedule() {
      const text = scheduleOutput.innerText;
      navigator.clipboard.writeText(text).then(() => {
        const copyBtn = document.querySelector('.copy-btn');
        const originalText = copyBtn.innerHTML;
        copyBtn.innerHTML = '‚úÖ Copied!';
        setTimeout(() => {
          copyBtn.innerHTML = originalText;
        }, 2000);
      }).catch(err => {
        alert('Failed to copy. Please select and copy manually.');
      });
    }
  </script>
</body>
</html>
